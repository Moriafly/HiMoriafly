"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.trailingSlashMiddleware = void 0;
/**
 * A middleware to add trailing slash to the url
 *
 * It will redirect '/foo' to '/foo/' with 302
 */
const trailingSlashMiddleware = (req, res, next) => {
    var _a;
    if (
    // only add trailing slash in GET and HEAD requests
    !['GET', 'HEAD'].includes(req.method) ||
        (
        // if the last section of the path has a dot, we think it has extension
        // and should not add trailing slash
        (_a = req.path.split('/').pop()) === null || _a === void 0 ? void 0 : _a.includes('.')) ||
        // if the path already has trailing slash
        req.path.endsWith('/')) {
        return next();
    }
    // add trailing slash and retain query
    // notice that we should not use 301 in dev-server
    const query = req.url.slice(req.path.length);
    res.redirect(302, `${req.path}/${query}`);
};
exports.trailingSlashMiddleware = trailingSlashMiddleware;
