"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPageDepsHelper = void 0;
/**
 * Create page deps helper
 */
const createPageDepsHelper = () => {
    const store = new Map();
    return {
        add: ({ deps, filePathRelative }) => {
            const depsAdded = [];
            if (filePathRelative) {
                deps.forEach((item) => {
                    var _a;
                    if (!store.has(item)) {
                        store.set(item, new Set());
                        depsAdded.push(item);
                    }
                    (_a = store.get(item)) === null || _a === void 0 ? void 0 : _a.add(filePathRelative);
                });
            }
            return depsAdded;
        },
        remove: ({ deps, filePathRelative }) => {
            const depsRemoved = [];
            if (filePathRelative) {
                deps.forEach((item) => {
                    const pagePathsSet = store.get(item);
                    pagePathsSet === null || pagePathsSet === void 0 ? void 0 : pagePathsSet.delete(filePathRelative);
                    if ((pagePathsSet === null || pagePathsSet === void 0 ? void 0 : pagePathsSet.size) === 0) {
                        store.delete(item);
                        depsRemoved.push(item);
                    }
                });
            }
            return depsRemoved;
        },
        get: (dep) => {
            const pagePathsSet = store.get(dep);
            return pagePathsSet ? [...pagePathsSet] : [];
        },
    };
};
exports.createPageDepsHelper = createPageDepsHelper;
