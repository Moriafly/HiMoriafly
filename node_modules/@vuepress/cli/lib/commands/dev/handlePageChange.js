"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handlePageChange = void 0;
const core_1 = require("@vuepress/core");
/**
 * Event handler for page change event
 *
 * Returns the old page and the new page tuple
 */
const handlePageChange = async (app, filePath) => {
    // get page index of the changed file
    const pageIndex = app.pages.findIndex((page) => page.filePath === filePath);
    if (pageIndex === -1) {
        return null;
    }
    // get the old page of the changed file
    const pageOld = app.pages[pageIndex];
    // create a new page from the changed file
    const pageNew = await (0, core_1.createPage)(app, {
        filePath,
    });
    // replace the old page with the new page
    app.pages.splice(pageIndex, 1, pageNew);
    // prepare page files
    await (0, core_1.preparePageComponent)(app, pageNew);
    await (0, core_1.preparePageData)(app, pageNew);
    const isPathChanged = pageOld.path !== pageNew.path;
    const isRouteMetaChanged = JSON.stringify(pageOld.routeMeta) !== JSON.stringify(pageNew.routeMeta);
    // prepare pages entry if the path is changed
    if (isPathChanged) {
        await (0, core_1.preparePagesComponents)(app);
        await (0, core_1.preparePagesData)(app);
    }
    // prepare pages routes if the path or routeMeta is changed
    if (isPathChanged || isRouteMetaChanged) {
        await (0, core_1.preparePagesRoutes)(app);
    }
    return [pageOld, pageNew];
};
exports.handlePageChange = handlePageChange;
