"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.appUse = void 0;
const utils_1 = require("@vuepress/utils");
const resolvePluginObject_1 = require("./resolvePluginObject");
const log = (0, utils_1.debug)('vuepress:core/app');
const appUse = (app, rawPlugin, config) => {
    const plugin = (0, resolvePluginObject_1.resolvePluginObject)(app, rawPlugin, config);
    log(`use plugin ${utils_1.chalk.magenta(plugin.name)}`);
    if (plugin.multiple !== true) {
        // remove duplicated plugin
        const duplicateIndex = app.pluginApi.plugins.findIndex(({ name }) => name === plugin.name);
        if (duplicateIndex !== -1) {
            app.pluginApi.plugins.splice(duplicateIndex, 1);
            // show warning when duplicate plugins are detected
            (0, utils_1.warn)(`plugin ${utils_1.chalk.magenta(plugin.name)} has been used multiple times, only the last one will take effect`);
        }
    }
    // use plugin
    app.pluginApi.plugins.push(plugin);
    return app;
};
exports.appUse = appUse;
