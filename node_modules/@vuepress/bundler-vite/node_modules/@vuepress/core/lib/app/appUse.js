"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.appUse = void 0;
const utils_1 = require("@vuepress/utils");
const resolvePluginObject_1 = require("./resolvePluginObject");
const log = (0, utils_1.debug)('vuepress:core/app');
const appUse = (app, rawPlugin) => {
    const pluginObject = (0, resolvePluginObject_1.resolvePluginObject)(app, rawPlugin);
    // ignore anonymous plugins or theme
    if (!pluginObject.name) {
        (0, utils_1.warn)(`an anonymous plugin or theme was detected and ignored`);
        return app;
    }
    log(`use plugin ${utils_1.chalk.magenta(pluginObject.name)}`);
    // handle duplicated plugins
    if (pluginObject.multiple !== true) {
        const duplicateIndex = app.pluginApi.plugins.findIndex(({ name }) => name === pluginObject.name);
        if (duplicateIndex !== -1) {
            // remove the previous duplicated plugin
            app.pluginApi.plugins.splice(duplicateIndex, 1);
            (0, utils_1.warn)(`plugin ${utils_1.chalk.magenta(pluginObject.name)} has been used multiple times, only the last one will take effect`);
        }
    }
    // use plugin
    app.pluginApi.plugins.push(pluginObject);
    return app;
};
exports.appUse = appUse;
