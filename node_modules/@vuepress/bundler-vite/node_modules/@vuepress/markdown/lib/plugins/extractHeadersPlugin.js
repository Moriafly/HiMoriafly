"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractHeadersPlugin = void 0;
const utils_1 = require("../utils");
/**
 * Extracting markdown headers to env
 *
 * Would be used for generating sidebar nav and toc
 */
const extractHeadersPlugin = (md, { level = [2, 3], slugify = utils_1.slugify, format, } = {}) => {
    let headers;
    // push the rule to the end of the chain
    // resolve headers from the parsed tokens
    md.core.ruler.push('resolveExtractHeaders', (state) => {
        headers = (0, utils_1.resolveHeadersFromTokens)(state.tokens, {
            level,
            allowHtml: false,
            escapeText: false,
            slugify,
            format,
        });
        return true;
    });
    // extract headers to env
    const render = md.render.bind(md);
    md.render = (src, env = {}) => {
        const result = render(src, env);
        env.headers = headers;
        return result;
    };
};
exports.extractHeadersPlugin = extractHeadersPlugin;
